<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Netflix UI Player</title>

    <style>
        body {
            margin: 0;
            background: #000;
            font-family: Helvetica, Arial, sans-serif;
        }

        .artplayer-app {
            width: 100%;
            max-width: 960px;
            height: 540px;
            margin: 40px auto;
            background: #000;
            position: relative;
        }

        .netflix-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 10;
            background: linear-gradient(to bottom, rgba(0,0,0,.8), transparent);
        }

        .back-arrow {
            width: 26px;
            height: 26px;
            fill: white;
            cursor: pointer;
        }

        .movie-title {
            color: #fff;
            font-size: 20px;
            text-transform: capitalize;
        }

        .netflix-spinner {
            width: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>

<body>

<div class="artplayer-app">
    <div class="netflix-header">
        <svg class="back-arrow" viewBox="0 0 24 24" onclick="history.back()">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
        </svg>
        <div class="movie-title" id="title">Loading...</div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/artplayer@5.0.9/dist/artplayer.js"></script>

<script>
/* ─────────────────────────────────────────────
   1️⃣ GET SLUG FROM URL (VERCEL SAFE)
───────────────────────────────────────────── */
const slug =
  decodeURIComponent(window.location.pathname.replace(/^\/+/, "")) ||
  "stranger.things.s05e06";

document.getElementById("title").innerText =
  slug.replaceAll(".", " ");

/* ─────────────────────────────────────────────
   2️⃣ API + PROXY
───────────────────────────────────────────── */
const RENDER_API =
  "https://u-1-1azw.onrender.com/api/get-stream?title=";

const PROXY =
  "https://workingg.vercel.app/api/proxy?url=";

/* ─────────────────────────────────────────────
   3️⃣ INIT PLAYER
───────────────────────────────────────────── */
(async () => {
  try {
    const res = await fetch(RENDER_API + slug);
    const data = await res.json();

    const m3u8 =
      data.m3u8_url || data.streamUrl || data.url;

    if (!m3u8) throw "No stream";

    const finalUrl = PROXY + encodeURIComponent(m3u8);

    const art = new Artplayer({
        container: ".artplayer-app",
        url: finalUrl,
        type: "m3u8",
        autoplay: true,
        autoSize: true,
        fullscreen: true,
        fullscreenWeb: true,
        theme: "#e50914",
        playbackRate: true,
        pip: true,
        setting: true,
        airplay: true,
        mutex: true,
        backdrop: true,
        icons: {
            loading:
              '<img class="netflix-spinner" src="https://assets.nflxext.com/en_us/pages/wiplayer/site-spinner.png">'
        },
        customType: {
            m3u8(video, url) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(video);
                }
            }
        }
    });

  } catch (e) {
    document.getElementById("title").innerText = "Stream Not Found";
  }
})();
</script>

</body>
</html>

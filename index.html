<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ArtPlayer Stream</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.css">

<style>
body {
    margin: 0;
    background: #000;
    font-family: Arial, Helvetica, sans-serif;
}
.artplayer-app {
    width: 100%;
    height: 100vh;
}
.header {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding: 15px;
    color: #fff;
    z-index: 10;
    background: linear-gradient(to bottom, rgba(0,0,0,.7), transparent);
}
.title {
    font-size: 18px;
    text-transform: capitalize;
}
</style>
</head>

<body>

<div class="header">
    <div class="title" id="title">Loadingâ€¦</div>
</div>

<div class="artplayer-app"></div>

<script src="https://cdn.jsdelivr.net/npm/@swarmcloud/hls/hls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/artplayer/dist/artplayer.js"></script>

<script>
/* ================================
   1. GET SLUG FROM URL
================================ */
const slug = location.pathname.replace('/', '') || 'home';
document.getElementById('title').innerText = slug.replaceAll('.', ' ');

/* ================================
   2. BUILD API URLS
================================ */
const RENDER_API =
  'https://u-1-1azw.onrender.com/api/get-stream?title=' + encodeURIComponent(slug);

const PROXY =
  'https://workingg.vercel.app/api/proxy?url=';

/* ================================
   3. FETCH STREAM URL
================================ */
async function init() {
  try {
    const res = await fetch(RENDER_API);
    const data = await res.json();

    const streamUrl = data.streamUrl || data.url;
    if (!streamUrl) throw 'No stream';

    const finalUrl = PROXY + encodeURIComponent(streamUrl);

    /* ================================
       4. ARTPLAYER
    ================================ */
    new Artplayer({
      container: '.artplayer-app',
      url: finalUrl,
      autoplay: true,
      muted: false,
      playsInline: true,
      fullscreen: true,
      fullscreenWeb: true,
      airplay: true,
      pip: true,
      setting: true,
      theme: '#e50914',

      customType: {
        m3u8: function (video, url) {
          if (video.canPlayType('application/vnd.apple.mpegurl')) {
            // iOS / Safari native HLS
            video.src = url;
          } else if (Hls.isSupported()) {
            const hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(video);
          }
        }
      }
    });

  } catch (e) {
    document.getElementById('title').innerText = 'Stream not found';
    console.error(e);
  }
}

init();
</script>

</body>
</html>
